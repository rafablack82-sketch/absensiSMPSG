<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Absensi Online SMP SG</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 30px; }
    h2 { color: #0066cc; }
    form { max-width: 400px; padding: 20px; border: 1px solid #ccc; border-radius: 10px; }
    label { font-weight: bold; display: block; margin-top: 10px; }
    input, select, button { width: 100%; padding: 8px; margin-top: 5px; }
    .note { font-size: 0.9em; color: gray; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>Absensi Online SMP SG</h2>
  <form id="absensiForm">
    <label for="nama">Nama:</label>
    <input type="text" id="nama" name="nama" required>

    <label for="kelas">Kelas:</label>
    <select id="kelas" name="kelas" required>
      <option value="">-- Pilih Kelas --</option>
      <option value="7A">7A</option>
      <option value="7B">7B</option>
      <option value="7C">7C</option>
      <option value="7D">7D</option>
      <option value="8A">8A</option>
      <option value="8B">8B</option>
      <option value="8C">8C</option>
      <option value="8D">8D</option>
      <option value="9A">9A</option>
      <option value="9B">9B</option>
      <option value="9C">9C</option>
      <option value="9D">9D</option>
    </select>

    <input type="hidden" id="lat" name="lat">
    <input type="hidden" id="lon" name="lon">

    <button type="submit">Kirim Absensi</button>
    <div class="note">Pastikan GPS aktif sebelum absen</div>
  </form>

  <script>
    // ambil lokasi GPS
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(pos) {
        document.getElementById("lat").value = pos.coords.latitude;
        document.getElementById("lon").value = pos.coords.longitude;
      }, function(err) {
        alert("Gagal ambil lokasi: " + err.message);
      });
    } else {
      alert("Browser tidak mendukung GPS.");
    }

    // saat form dikirim
    document.getElementById("absensiForm").addEventListener("submit", function(e) {
      e.preventDefault();

      const nama = document.getElementById("nama").value;
      const kelas = document.getElementById("kelas").value;
      const lat = document.getElementById("lat").value;
      const lon = document.getElementById("lon").value;

      // URL Google Form (ganti dengan milik Bapak)
      const formURL = "https://docs.google.com/forms/d/e/1FAIpQLSfce9hxm3mzRmnQfudfxSFrWiazNOcnVKYieDW8ITbPKYyC7g/formResponse?";

      // Mapping ke entry masing-masing field (pakai entry.* dari form Bapak)
      const data = new URLSearchParams();
      data.append("entry.1650028786", nama);   // Nama
      data.append("entry.2089936329", kelas);  // Kelas
      data.append("entry.1532119486", lat);    // Latitude
      data.append("entry.1697944181", lon);    // Longitude

      // kirim data
      fetch(formURL, {
        method: "POST",
        mode: "no-cors",
        body: data
      }).then(() => {
        alert("Absensi berhasil dikirim!");
        document.getElementById("absensiForm").reset();
      }).catch(err => {
        alert("Gagal kirim absensi: " + err);
      });
    });
  </script>
</body>
</html>
